import{r,a as R,u as I,s as A,j as e,L}from"./index-DuBDwv8b.js";const O="https://www.cape-control.com/api";async function j(o,g,t=0){try{const d=new AbortController,m=setTimeout(()=>d.abort(),25e3),i=await fetch(`${O}/auth/v2/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:g}),signal:d.signal});clearTimeout(m);const a=i.headers.get("content-type");if(!i.ok){if(i.status===503&&t<2){const c=Math.pow(2,t)*1e3;return console.log(`Retrying login after ${c}ms (attempt ${t+1})`),await new Promise(u=>setTimeout(u,c)),j(o,g,t+1)}if(i.status===503)throw new Error("Service temporarily unavailable. Please try again in a moment.");if(a&&a.includes("application/json")){const c=await i.json();throw new Error(c.detail||"Login failed")}else throw new Error(`Server error (${i.status}). Please try again later.`)}if(!a||!a.includes("application/json"))throw new Error("Server returned invalid response format");return await i.json()}catch(d){if(d.name==="AbortError"||d.message.includes("timed out")){if(t<2){console.log(`Login timed out, retrying... (attempt ${t+1})`);const m=2e3;return await new Promise(i=>setTimeout(i,m)),j(o,g,t+1)}throw new Error("Login request timed out. Please check your connection and try again.")}throw console.error("Login error:",d),d}}function q(){const[o,g]=r.useState(""),[t,y]=r.useState(""),[v,d]=r.useState(!1),[m,i]=r.useState(!1),[a,c]=r.useState({}),[u,N]=r.useState(!1),[w,S]=r.useState(null),[h,p]=r.useState(null),{setUser:E}=R(),k=I();r.useCallback(()=>{const s={};return o?/\S+@\S+\.\S+/.test(o)||(s.email="invalid email format"):s.email="email is required",t?t.length<6&&(s.password="Password must be at least 6 characters"):s.password="password is required",s},[o,t]);const P=r.useCallback(async s=>{s.preventDefault();const n={};if(o?/\S+@\S+\.\S+/.test(o)||(n.email="invalid email format"):n.email="email is required",t?t.length<6&&(n.password="Password must be at least 6 characters"):n.password="password is required",Object.keys(n).length>0){c(n);return}c({}),S(null),N(!0),p(null);const l=performance.now();try{console.log(`ðŸš€ Login attempt started at ${new Date().toISOString()}`);const x=await j(o,t),f=performance.now(),b=Math.round(f-l);p(b),console.log(`âœ… Login successful in ${b}ms`),A(x.access_token),E(x.user),k("/dashboard")}catch(x){const f=performance.now(),b=Math.round(f-l);p(b),console.log(`âŒ Login failed in ${b}ms: ${x.message}`),S(x.message||"Login failed")}finally{N(!1)}},[o,t,E,k]),M=r.useCallback(s=>{const n=s.target.value;g(n),c(l=>l.email?{...l,email:""}:l)},[]),C=r.useCallback(s=>{const n=s.target.value;y(n),c(l=>l.password?{...l,password:""}:l)},[]),$=r.useCallback(()=>{i(s=>!s)},[]),T=r.useCallback(s=>{console.log(`Social login with ${s}`)},[]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center px-4 py-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-6 sm:p-8 border border-gray-100",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Login"}),e.jsx("p",{className:"text-gray-600",children:"Sign in to your account"})]}),w&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"text-red-800 text-sm font-medium",role:"alert",children:[w,h&&e.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Request took ",h,"ms"]})]})}),h&&!w&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"text-green-800 text-sm font-medium",children:["Login successful in ",h,"ms"]})}),e.jsxs("form",{onSubmit:P,role:"form","aria-labelledby":"login-heading",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{id:"email",className:`input-mobile ${a.email?"border-red-500":""}`,type:"email",autoComplete:"username",placeholder:"Enter your email",value:o,onChange:M,"aria-describedby":a.email?"email-error":void 0,disabled:u}),a.email&&e.jsx("div",{id:"email-error",className:"text-red-600 text-sm mt-1",role:"alert",children:a.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",className:`input-mobile pr-10 ${a.password?"border-red-500":""}`,type:m?"text":"password",autoComplete:"current-password",placeholder:"Enter your password",value:t,onChange:C,"aria-describedby":a.password?"password-error":void 0,disabled:u}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:$,"aria-label":m?"Hide password":"Show password","data-testid":"password-toggle",tabIndex:-1,children:e.jsx("span",{className:"text-gray-400 hover:text-gray-600",children:m?"ï¿½":"ðŸ‘"})})]}),a.password&&e.jsx("div",{id:"password-error",className:"text-red-600 text-sm mt-1",role:"alert",children:a.password})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:v,onChange:s=>d(s.target.checked)}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]}),e.jsx("button",{className:"btn-mobile-lg w-full bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transition-all duration-200",type:"submit",disabled:u,children:u?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-3"}),e.jsx("span",{children:"Logging in..."}),h&&e.jsxs("span",{className:"ml-2 text-xs opacity-75",children:["(",Math.round(performance.now()-h),"ms)"]})]}):"Login"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",onClick:()=>T("google"),children:"Continue with Google"}),e.jsx("button",{type:"button",className:"w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",onClick:()=>T("github"),children:"Continue with GitHub"})]})]}),e.jsxs("div",{className:"mt-8 text-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(L,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500 transition-colors",children:"Sign up"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(L,{to:"/forgot-password",className:"text-sm text-blue-600 hover:text-blue-500 transition-colors",children:"Forgot password?"})})]})]})})})}export{q as default};
