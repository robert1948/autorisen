# Heroku Container Deployment Configuration
# AutoLocal/CapeControl Production Deployment
# Updated: November 9, 2025

build:
  docker:
    web: Dockerfile
    worker: Dockerfile
  config:
    NODE_ENV: production
    ENV: prod
    DEBUG: false

release:
  image: web
  command:
    - sh
    - -c
    - |
      echo "ðŸ›‘ Release phase migrations are DISABLED by policy."
      echo "Run explicit migrations via: make heroku-run-migrate HEROKU_APP_NAME=$HEROKU_APP_NAME"
      echo "âœ… Release phase completed (no migrations)"

run:
  web: sh -c "exec gunicorn backend.src.app:app -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --workers ${WEB_CONCURRENCY:-2} --worker-tmp-dir /dev/shm --access-logfile - --error-logfile - --log-level info --keep-alive 2 --max-requests 1000 --max-requests-jitter 50 --timeout 30"
  worker: sh -c "python -m backend.src.worker.email_worker"
