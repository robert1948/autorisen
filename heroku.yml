# Heroku Container Deployment Configuration
# AutoLocal/CapeControl Production Deployment
# Updated: November 9, 2025

build:
  docker:
    web: Dockerfile
  config:
    NODE_ENV: production
    ENV: prod
    DEBUG: false

release:
  image: web
  command:
    - sh
    - -c
    - |
      echo "üóÉÔ∏è Running database migrations..."
      python -m alembic -c backend/alembic.ini upgrade head || echo "‚ö†Ô∏è Migration failed or not needed"
      echo "‚úÖ Release phase completed"

run:
  web: sh -c "exec gunicorn backend.src.app:app -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT --workers ${WEB_CONCURRENCY:-2} --worker-tmp-dir /dev/shm --access-logfile - --error-logfile - --log-level info --keep-alive 2 --max-requests 1000 --max-requests-jitter 50 --timeout 30"
